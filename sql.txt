1050. Actors and Directors Who Cooperated At Least Three Times
# Write your MySQL query statement below
SELECT actor_id, director_id
FROM (
    SELECT actor_id, director_id, COUNT(*) as cnt
    FROM ActorDirector
    GROUP BY actor_id, director_id
) AS pairs
WHERE pairs.cnt >= 3;


1407. Top Travellers
# Write your MySQL query statement below
SELECT u.name, IFNULL(SUM(distance), 0) as travelled_distance
FROM Users u
LEFT JOIN Rides r ON u.id = r.user_id
GROUP BY u.id
ORDER BY travelled_distance DESC, name ASC;


1280. Students and Examinations
# Write your MySQL query statement below
SELECT s.student_id, s.student_name, s.subject_name, IFNULL(e.cnt, 0) AS attended_exams
FROM (
    SELECT st.student_id, st.student_name, sub.subject_name
    FROM Students st
    CROSS JOIN Subjects sub
) s
LEFT JOIN (
    SELECT e.student_id, e.subject_name, IFNULL(COUNT(*), 0) as cnt
    FROM Subjects s
    LEFT JOIN Examinations e 
    ON s.subject_name = e.subject_name
    GROUP BY e.student_id, e.subject_name
) e
ON s.student_id = e.student_id AND s.subject_name = e.subject_name
ORDER BY s.student_id, s.subject_name


1683. Invalid Tweets
# Write your MySQL query statement below
SELECT tweet_id
FROM Tweets
WHERE LENGTH(content) > 15


1587. Bank Account Summary II
# Write your MySQL query statement below
SELECT u.name, SUM(t.amount) AS balance
FROM Users u
LEFT JOIN Transactions t
ON u.account = t.account
GROUP BY u.account
HAVING balance > 10000;


1633. Percentage of Users Attended a Contest
# Write your MySQL query statement below
SELECT r.contest_id, ROUND(r.cnt/u.num*100, 2) AS percentage
FROM (
    SELECT *
    FROM Users usr, (SELECT COUNT(*) AS num FROM Users) c
) u
LEFT JOIN (
    SELECT *, COUNT(*) AS cnt
    FROM Register
    GROUP BY contest_id
) r ON u.user_id = r.user_id 
WHERE contest_id IS NOT NULL
ORDER BY percentage DESC, r.contest_id ASC;


1757. Recyclable and Low Fat Products
# Write your MySQL query statement below
SELECT product_id
FROM Products
WHERE low_fats = 'Y' AND recyclable = 'Y';


1729. Find Followers Count
# Write your MySQL query statement below
SELECT user_id, COUNT(*) as followers_count
FROM Followers
GROUP BY user_id
ORDER BY user_id


1741. Find Total Time Spent by Each Employee
# Write your MySQL query statement below
select event_day as day, emp_id, sum(out_time - in_time) as total_time
from Employees
group by event_day, emp_id


1965. Employees With Missing Information
# Write your MySQL query statement below
select *
from Employees e
left join Salaries s on e.employee_id = s.employee_id
union
select *
from Employees e
right join Salaries s on e.employee_id = s.employee_id
where e.employee_id is null


610. Triangle Judgement
# Write your MySQL query statement below
select *, if(x + y > z and x + z > y and y + z > x, 'Yes', 'No') as triangle
from Triangle


178. Rank Scores
# Write your MySQL query statement below
select
    score,
    dense_rank() over (order by score desc) as `rank`
from Scores


1378. Replace Employee ID With The Unique Identifier
# Write your MySQL query statement below
select u.unique_id, e.name
from Employees e
left join EmployeeUNI u on e.id = u.id

183. Customers Who Never Order

SELECT
    c.name AS Customers
FROM
    Customers c
LEFT JOIN 
    Orders o ON c.id = o.customerId
WHERE
    o.customerId IS NULL;


181. Employees Earning More Than Their Managers

SELECT name as Employee
FROM Employee AS a
WHERE salary > (SELECT salary FROM Employee AS b WHERE a.managerId = b.id);


577. Employee Bonus

SELECT e.name, b.bonus
FROM Employee e
LEFT JOIN Bonus b ON e.empId=b.empId
WHERE b.bonus < 1000 or b.bonus IS null


196. Delete Duplicate Emails

DELETE p1 FROM Person p1, Person p2
WHERE p1.email=p2.email AND p1.id>p2.id

# 607. Sales Person

# select name
# from SalesPerson
# where name not in 
# (select p.name
# from SalesPerson p
# inner join Orders o
# on p.sales_id = o.sales_id
# inner join Company c
# on o.com_id = c.com_id
# where c.name = 'RED')

# 596. Classes With at Least 5 Students

# select c.class
# from (select class, count(*) as cnt
# from Courses
# group by class) as c
# where c.cnt >= 5


# 595. Big Countries

# SELECT name, population, area
# FROM World
# WHERE area >= 3000000 OR population >= 25000000


1873. Calculate Special Bonus
# Write your MySQL query statement below
select 
    employee_id, 
    if(employee_id % 2 != 0 and left(name, 1) != 'M', salary, 0) as bonus
from Employees
order by employee_id


184. Department Highest Salary
# Write your MySQL query statement below
select 
    d.name as Department, 
    e.name as Employee,
    salary as Salary
from Employee e
left join Department d on e.departmentId = d.id
left join (
    select departmentId, max(salary) as mx
    from Employee
    group by departmentId
) s on e.departmentId = s.departmentId
where e.salary = s.mx


1965. Employees With Missing Information
# Write your MySQL query statement below
select ifnull(e.employee_id, s.employee_id) as employee_id
from Employees e
left join Salaries s on e.employee_id = s.employee_id
where e.name is null or s.salary is null
union
select ifnull(e.employee_id, s.employee_id) as employee_id
from Employees e
right join Salaries s on e.employee_id = s.employee_id
where e.name is null or s.salary is null
order by employee_id asc


1795. Rearrange Products Table
# Write your MySQL query statement below
select product_id, 'store1' as store, store1 as price
from Products
where store1 is not null
union
select product_id, 'store2' as store, store2 as price
from Products
where store2 is not null
union
select product_id, 'store3' as store, store3 as price
from Products
where store3 is not null


3642. Find Books with Polarized Opinions
# Write your MySQL query statement below
select
    b.book_id,
    b.title, 
    b.author,
    b.genre,
    b.pages,
    max(r.session_rating)-min(r.session_rating) as rating_spread,
    r.polarization_score
from books b
left join (
    select r.book_id, r.session_rating, p.polarization_score
    from reading_sessions r
    left join (
        select 
            book_id, 
            round(count(case when session_rating <= 2 or session_rating >= 4 then 1 end)/count(*), 2) as polarization_score    
        from reading_sessions
        group by book_id
    ) p on r.book_id = p.book_id
) r
on b.book_id = r.book_id
group by r.book_id
having count(*) >= 5 and r.polarization_score >= 0.6 and max(r.session_rating) >= 4 and min(r.session_rating) <= 2
order by r.polarization_score desc, b.title desc


1084. Sales Analysis III
# Write your MySQL query statement below
select p.product_id, p.product_name
from Product p
left join (
    select *, sum(if(sale_date between '2019-01-01' and '2019-03-31', 0, 1)) as iff
    from Sales
    group by product_id
) s
on p.product_id = s.product_id
where s.iff = 0


197. Rising Temperature
# Write your MySQL query statement below
select w1.id
from Weather w1
left join Weather w2
on w1.recordDate - interval 1 day = w2.recordDate
where w1.temperature > w2.temperature


1164. Product Price at a Given Date
# Write your MySQL query statement below
select p.product_id, p.new_price as price
from (
    select *
    from (
        select p.product_id, p.new_price, change_date
        from (
            select *
            from Products
            where change_date <= '2019-08-16'
            union
            select p.product_id, 10 as new_price, c.change_date
            from Products p, (
                select subdate(min(change_date), interval 1 day) as change_date
                from Products
            ) c
        ) p
    ) p
    left join (
        select p1.product_id as pid, max(p1.change_date) as cd
        from (
            select p.product_id, p.new_price, max(p.change_date) as change_date
            from (
                select *
                from Products
                where change_date <= '2019-08-16'
                union
                select p.product_id, 10 as new_price, c.change_date
                from Products p, (
                    select subdate(min(change_date), interval 1 day) as change_date
                    from Products
                ) c
            ) p
            group by product_id
        ) p1
        group by product_id
    ) d on p.product_id = d.pid and p.change_date = d.cd 
    where pid is not null
) p


620. Not Boring Movies
# Write your MySQL query statement below
SELECT *
FROM Cinema
WHERE id % 2 = 1 AND description != 'boring'
ORDER BY rating DESC


3220. Odd and Even Transactions
# Write your MySQL query statement below
select
    transaction_date,
    sum(case when amount % 2 != 0 then amount else 0 end) as odd_sum,
    sum(case when amount % 2 = 0 then amount else 0 end) as even_sum
from transactions
group by transaction_date
order by transaction_date asc


1934. Confirmation Rate
# Write your MySQL query statement below
select c.user_id, round(sum(c.confirm)/count(*), 2) as confirmation_rate
from (
    select s.user_id, if(action = 'confirmed', 1, 0) as confirm
    from Signups s
    left join Confirmations c
    on s.user_id = c.user_id
) c
group by c.user_id


3793. Find Users with High Token Usage
# Write your MySQL query statement below
select p.user_id, c.prompt_count, round(sum(p.tokens)/c.prompt_count, 2) as avg_tokens
from prompts p
left join
(
    select *, count(*) as prompt_count
    from prompts
    group by user_id
) c
on p.user_id = c.user_id
where c.prompt_count >= 3
group by p.user_id
having max(p.tokens) > avg_tokens
order by avg_tokens desc, p.user_id asc


3564. Seasonal Sales Analysis
# Write your MySQL query statement below
(select 
    s.season, 
    s.category, 
    sum(s.total_quantity) as total_quantity, 
    sum(s.total_revenue) as total_revenue
from (
    select 
        'Fall' as season, 
        sum(s.quantity) as total_quantity, 
        sum(s.quantity * price) as total_revenue,
        p.category,
        p.product_name,
        s.product_id
    from sales s
    left join products p
    on s.product_id = p.product_id
    where month(sale_date) between 9 and 11
    group by p.product_name
) s
group by s.category
order by total_quantity desc, total_revenue desc, s.category asc
limit 1)
union
(select 
    s.season, 
    s.category, 
    sum(s.total_quantity) as total_quantity, 
    sum(s.total_revenue) as total_revenue
from (
    select 
        'Spring' as season, 
        sum(s.quantity) as total_quantity, 
        sum(s.quantity * price) as total_revenue,
        p.category,
        p.product_name,
        s.product_id
    from sales s
    left join products p
    on s.product_id = p.product_id
    where month(sale_date) between 3 and 5
    group by p.product_name
) s
group by s.category
order by total_quantity desc, total_revenue desc, s.category asc
limit 1)
union
(select 
    s.season, 
    s.category, 
    sum(s.total_quantity) as total_quantity, 
    sum(s.total_revenue) as total_revenue
from (
    select 
        'Summer' as season, 
        sum(s.quantity) as total_quantity, 
        sum(s.quantity * price) as total_revenue,
        p.category,
        p.product_name,
        s.product_id
    from sales s
    left join products p
    on s.product_id = p.product_id
    where month(sale_date) between 6 and 8
    group by p.product_name
) s
group by s.category
order by total_quantity desc, total_revenue desc, s.category asc
limit 1)
union
(select 
    s.season, 
    s.category, 
    sum(s.total_quantity) as total_quantity, 
    sum(s.total_revenue) as total_revenue
from (
    select 
        'Winter' as season, 
        sum(s.quantity) as total_quantity, 
        sum(s.quantity * price) as total_revenue,
        p.category,
        p.product_name,
        s.product_id
    from sales s
    left join products p
    on s.product_id = p.product_id
    where month(sale_date) between 1 and 2 or month(sale_date) = 12
    group by p.product_name
) s
group by s.category
order by total_quantity desc, total_revenue desc, s.category asc
limit 1)